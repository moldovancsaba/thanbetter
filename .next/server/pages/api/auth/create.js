"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/auth/create";
exports.ids = ["pages/api/auth/create"];
exports.modules = {

/***/ "(api-node)/./lib/db/mongodb.ts":
/*!***************************!*\
  !*** ./lib/db/mongodb.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_0__);\n\nif (!process.env.MONGODB_URI) {\n    throw new Error('Please add your Mongo URI to .env.local');\n}\nconst uri = process.env.MONGODB_URI + '/sso';\nconst options = {};\nlet client;\nlet clientPromise;\nif (true) {\n    // In development mode, use a global variable so that the value\n    // is preserved across module reloads caused by HMR (Hot Module Replacement).\n    let globalWithMongo = global;\n    if (!globalWithMongo._mongoClientPromise) {\n        client = new mongodb__WEBPACK_IMPORTED_MODULE_0__.MongoClient(uri, options);\n        globalWithMongo._mongoClientPromise = client.connect();\n    }\n    clientPromise = globalWithMongo._mongoClientPromise;\n} else {}\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (clientPromise);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9kYi9tb25nb2RiLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFzQztBQUV0QyxJQUFJLENBQUNDLFFBQVFDLEdBQUcsQ0FBQ0MsV0FBVyxFQUFFO0lBQzVCLE1BQU0sSUFBSUMsTUFBTTtBQUNsQjtBQUVBLE1BQU1DLE1BQU1KLFFBQVFDLEdBQUcsQ0FBQ0MsV0FBVyxHQUFHO0FBQ3RDLE1BQU1HLFVBQVUsQ0FBQztBQUVqQixJQUFJQztBQUNKLElBQUlDO0FBRUosSUFBSVAsSUFBc0MsRUFBRTtJQUMxQywrREFBK0Q7SUFDL0QsNkVBQTZFO0lBQzdFLElBQUlRLGtCQUFrQkM7SUFJdEIsSUFBSSxDQUFDRCxnQkFBZ0JFLG1CQUFtQixFQUFFO1FBQ3hDSixTQUFTLElBQUlQLGdEQUFXQSxDQUFDSyxLQUFLQztRQUM5QkcsZ0JBQWdCRSxtQkFBbUIsR0FBR0osT0FBT0ssT0FBTztJQUN0RDtJQUNBSixnQkFBZ0JDLGdCQUFnQkUsbUJBQW1CO0FBQ3JELE9BQU8sRUFJTjtBQUVELGlFQUFlSCxhQUFhQSxFQUFDIiwic291cmNlcyI6WyIvVXNlcnMvbW9sZG92YW4vUHJvamVjdHMvc3NvL2xpYi9kYi9tb25nb2RiLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE1vbmdvQ2xpZW50IH0gZnJvbSAnbW9uZ29kYic7XG5cbmlmICghcHJvY2Vzcy5lbnYuTU9OR09EQl9VUkkpIHtcbiAgdGhyb3cgbmV3IEVycm9yKCdQbGVhc2UgYWRkIHlvdXIgTW9uZ28gVVJJIHRvIC5lbnYubG9jYWwnKTtcbn1cblxuY29uc3QgdXJpID0gcHJvY2Vzcy5lbnYuTU9OR09EQl9VUkkgKyAnL3Nzbyc7XG5jb25zdCBvcHRpb25zID0ge307XG5cbmxldCBjbGllbnQ7XG5sZXQgY2xpZW50UHJvbWlzZTogUHJvbWlzZTxNb25nb0NsaWVudD47XG5cbmlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50Jykge1xuICAvLyBJbiBkZXZlbG9wbWVudCBtb2RlLCB1c2UgYSBnbG9iYWwgdmFyaWFibGUgc28gdGhhdCB0aGUgdmFsdWVcbiAgLy8gaXMgcHJlc2VydmVkIGFjcm9zcyBtb2R1bGUgcmVsb2FkcyBjYXVzZWQgYnkgSE1SIChIb3QgTW9kdWxlIFJlcGxhY2VtZW50KS5cbiAgbGV0IGdsb2JhbFdpdGhNb25nbyA9IGdsb2JhbCBhcyB0eXBlb2YgZ2xvYmFsVGhpcyAmIHtcbiAgICBfbW9uZ29DbGllbnRQcm9taXNlPzogUHJvbWlzZTxNb25nb0NsaWVudD47XG4gIH07XG5cbiAgaWYgKCFnbG9iYWxXaXRoTW9uZ28uX21vbmdvQ2xpZW50UHJvbWlzZSkge1xuICAgIGNsaWVudCA9IG5ldyBNb25nb0NsaWVudCh1cmksIG9wdGlvbnMpO1xuICAgIGdsb2JhbFdpdGhNb25nby5fbW9uZ29DbGllbnRQcm9taXNlID0gY2xpZW50LmNvbm5lY3QoKTtcbiAgfVxuICBjbGllbnRQcm9taXNlID0gZ2xvYmFsV2l0aE1vbmdvLl9tb25nb0NsaWVudFByb21pc2U7XG59IGVsc2Uge1xuICAvLyBJbiBwcm9kdWN0aW9uIG1vZGUsIGl0J3MgYmVzdCB0byBub3QgdXNlIGEgZ2xvYmFsIHZhcmlhYmxlLlxuICBjbGllbnQgPSBuZXcgTW9uZ29DbGllbnQodXJpLCBvcHRpb25zKTtcbiAgY2xpZW50UHJvbWlzZSA9IGNsaWVudC5jb25uZWN0KCk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsaWVudFByb21pc2U7XG4iXSwibmFtZXMiOlsiTW9uZ29DbGllbnQiLCJwcm9jZXNzIiwiZW52IiwiTU9OR09EQl9VUkkiLCJFcnJvciIsInVyaSIsIm9wdGlvbnMiLCJjbGllbnQiLCJjbGllbnRQcm9taXNlIiwiZ2xvYmFsV2l0aE1vbmdvIiwiZ2xvYmFsIiwiX21vbmdvQ2xpZW50UHJvbWlzZSIsImNvbm5lY3QiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./lib/db/mongodb.ts\n");

/***/ }),

/***/ "(api-node)/./lib/middleware/compose.ts":
/*!***********************************!*\
  !*** ./lib/middleware/compose.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   composeMiddleware: () => (/* binding */ composeMiddleware)\n/* harmony export */ });\nfunction composeMiddleware(...middlewares) {\n    return async function(req, res) {\n        // Creates a promise chain of middleware executions\n        const chain = middlewares.map((middleware)=>async (next)=>{\n                await middleware(req, res, next);\n            });\n        // Execute the chain\n        let index = 0;\n        const next = async ()=>{\n            if (index < chain.length) {\n                await chain[index++](next);\n            }\n        };\n        try {\n            await next();\n        } catch (error) {\n            console.error('Middleware chain error:', error);\n            res.status(500).json({\n                error: 'Internal server error'\n            });\n        }\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9taWRkbGV3YXJlL2NvbXBvc2UudHMiLCJtYXBwaW5ncyI6Ijs7OztBQVFPLFNBQVNBLGtCQUFrQixHQUFHQyxXQUFpQztJQUNwRSxPQUFPLGVBQWdCQyxHQUFtQixFQUFFQyxHQUFvQjtRQUM5RCxtREFBbUQ7UUFDbkQsTUFBTUMsUUFBUUgsWUFBWUksR0FBRyxDQUFDQyxDQUFBQSxhQUFjLE9BQU9DO2dCQUNqRCxNQUFNRCxXQUFXSixLQUFLQyxLQUFLSTtZQUM3QjtRQUVBLG9CQUFvQjtRQUNwQixJQUFJQyxRQUFRO1FBQ1osTUFBTUQsT0FBTztZQUNYLElBQUlDLFFBQVFKLE1BQU1LLE1BQU0sRUFBRTtnQkFDeEIsTUFBTUwsS0FBSyxDQUFDSSxRQUFRLENBQUNEO1lBQ3ZCO1FBQ0Y7UUFFQSxJQUFJO1lBQ0YsTUFBTUE7UUFDUixFQUFFLE9BQU9HLE9BQU87WUFDZEMsUUFBUUQsS0FBSyxDQUFDLDJCQUEyQkE7WUFDekNQLElBQUlTLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7Z0JBQUVILE9BQU87WUFBd0I7UUFDeEQ7SUFDRjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvbW9sZG92YW4vUHJvamVjdHMvc3NvL2xpYi9taWRkbGV3YXJlL2NvbXBvc2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gJ25leHQnO1xuXG50eXBlIE1pZGRsZXdhcmVGdW5jdGlvbiA9IChcbiAgcmVxOiBOZXh0QXBpUmVxdWVzdCxcbiAgcmVzOiBOZXh0QXBpUmVzcG9uc2UsXG4gIG5leHQ6ICgpID0+IHZvaWRcbikgPT4gdm9pZCB8IFByb21pc2U8dm9pZD47XG5cbmV4cG9ydCBmdW5jdGlvbiBjb21wb3NlTWlkZGxld2FyZSguLi5taWRkbGV3YXJlczogTWlkZGxld2FyZUZ1bmN0aW9uW10pIHtcbiAgcmV0dXJuIGFzeW5jIGZ1bmN0aW9uIChyZXE6IE5leHRBcGlSZXF1ZXN0LCByZXM6IE5leHRBcGlSZXNwb25zZSkge1xuICAgIC8vIENyZWF0ZXMgYSBwcm9taXNlIGNoYWluIG9mIG1pZGRsZXdhcmUgZXhlY3V0aW9uc1xuICAgIGNvbnN0IGNoYWluID0gbWlkZGxld2FyZXMubWFwKG1pZGRsZXdhcmUgPT4gYXN5bmMgKG5leHQ6ICgpID0+IHZvaWQgfCBQcm9taXNlPHZvaWQ+KSA9PiB7XG4gICAgICBhd2FpdCBtaWRkbGV3YXJlKHJlcSwgcmVzLCBuZXh0KTtcbiAgICB9KTtcblxuICAgIC8vIEV4ZWN1dGUgdGhlIGNoYWluXG4gICAgbGV0IGluZGV4ID0gMDtcbiAgICBjb25zdCBuZXh0ID0gYXN5bmMgKCkgPT4ge1xuICAgICAgaWYgKGluZGV4IDwgY2hhaW4ubGVuZ3RoKSB7XG4gICAgICAgIGF3YWl0IGNoYWluW2luZGV4KytdKG5leHQpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB0cnkge1xuICAgICAgYXdhaXQgbmV4dCgpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdNaWRkbGV3YXJlIGNoYWluIGVycm9yOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InIH0pO1xuICAgIH1cbiAgfTtcbn1cbiJdLCJuYW1lcyI6WyJjb21wb3NlTWlkZGxld2FyZSIsIm1pZGRsZXdhcmVzIiwicmVxIiwicmVzIiwiY2hhaW4iLCJtYXAiLCJtaWRkbGV3YXJlIiwibmV4dCIsImluZGV4IiwibGVuZ3RoIiwiZXJyb3IiLCJjb25zb2xlIiwic3RhdHVzIiwianNvbiJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./lib/middleware/compose.ts\n");

/***/ }),

/***/ "(api-node)/./lib/middleware/rateLimit.ts":
/*!*************************************!*\
  !*** ./lib/middleware/rateLimit.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   rateLimit: () => (/* binding */ rateLimit)\n/* harmony export */ });\n/* harmony import */ var _mongodb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../mongodb */ \"(api-node)/./lib/mongodb.ts\");\n\n// Sliding window rate limiter with burst control\nasync function rateLimit(req, res, next) {\n    const tenant = req.tenant;\n    const clientIp = req.headers['x-forwarded-for'] || req.socket.remoteAddress;\n    if (!tenant) {\n        return res.status(500).json({\n            error: 'Tenant information missing'\n        });\n    }\n    try {\n        const client = await _mongodb__WEBPACK_IMPORTED_MODULE_0__[\"default\"];\n        const db = client.db('sso');\n        const rateLimitCollection = db.collection('rate_limits');\n        const now = Date.now();\n        const windowStart = now - 60000; // One minute window\n        const key = `${tenant.id}:${clientIp}`;\n        // Get current rate limit info\n        const rateLimitInfo = await rateLimitCollection.findOne({\n            key\n        });\n        if (!rateLimitInfo) {\n            // First request from this tenant+IP\n            await rateLimitCollection.insertOne({\n                key,\n                count: 1,\n                resetTime: now + 60000,\n                firstRequestTime: now,\n                lastRequestTime: now\n            });\n        } else {\n            // Check if window has expired\n            if (now > rateLimitInfo.resetTime) {\n                // Start new window\n                await rateLimitCollection.updateOne({\n                    key\n                }, {\n                    $set: {\n                        count: 1,\n                        resetTime: now + 60000,\n                        firstRequestTime: now,\n                        lastRequestTime: now\n                    }\n                });\n            } else {\n                // Within current window\n                const elapsedTime = now - rateLimitInfo.firstRequestTime;\n                const normalizedCount = rateLimitInfo.count * (60000 - elapsedTime) / 60000;\n                // Check both rate and burst limits\n                if (normalizedCount >= tenant.settings.rateLimit.requestsPerMinute || rateLimitInfo.count >= tenant.settings.rateLimit.burstSize) {\n                    const retryAfter = Math.ceil((rateLimitInfo.resetTime - now) / 1000);\n                    res.setHeader('X-RateLimit-Limit', tenant.settings.rateLimit.requestsPerMinute);\n                    res.setHeader('X-RateLimit-Remaining', 0);\n                    res.setHeader('X-RateLimit-Reset', Math.ceil(rateLimitInfo.resetTime / 1000));\n                    res.setHeader('Retry-After', retryAfter);\n                    return res.status(429).json({\n                        error: 'Rate limit exceeded',\n                        retryAfter\n                    });\n                }\n                // Update counter\n                await rateLimitCollection.updateOne({\n                    key\n                }, {\n                    $inc: {\n                        count: 1\n                    },\n                    $set: {\n                        lastRequestTime: now\n                    }\n                });\n            }\n        }\n        // Set rate limit headers\n        const remaining = Math.max(0, tenant.settings.rateLimit.requestsPerMinute - (rateLimitInfo?.count || 1));\n        res.setHeader('X-RateLimit-Limit', tenant.settings.rateLimit.requestsPerMinute);\n        res.setHeader('X-RateLimit-Remaining', remaining);\n        res.setHeader('X-RateLimit-Reset', Math.ceil((rateLimitInfo?.resetTime || now + 60000) / 1000));\n        // Clean up old rate limit entries periodically (async)\n        rateLimitCollection.deleteMany({\n            resetTime: {\n                $lt: now\n            }\n        }).catch((err)=>console.error('Failed to cleanup rate limits:', err));\n        next();\n    } catch (error) {\n        console.error('Rate limiting error:', error);\n        return res.status(500).json({\n            error: 'Internal server error'\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9taWRkbGV3YXJlL3JhdGVMaW1pdC50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUV1QztBQWF2QyxpREFBaUQ7QUFDMUMsZUFBZUMsVUFDcEJDLEdBQW1CLEVBQ25CQyxHQUFvQixFQUNwQkMsSUFBZ0I7SUFFaEIsTUFBTUMsU0FBUyxJQUFhQSxNQUFNO0lBQ2xDLE1BQU1DLFdBQVdKLElBQUlLLE9BQU8sQ0FBQyxrQkFBa0IsSUFBY0wsSUFBSU0sTUFBTSxDQUFDQyxhQUFhO0lBRXJGLElBQUksQ0FBQ0osUUFBUTtRQUNYLE9BQU9GLElBQUlPLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFBRUMsT0FBTztRQUE2QjtJQUNwRTtJQUVBLElBQUk7UUFDRixNQUFNQyxTQUFzQixNQUFNYixnREFBYUE7UUFDL0MsTUFBTWMsS0FBS0QsT0FBT0MsRUFBRSxDQUFDO1FBQ3JCLE1BQU1DLHNCQUFzQkQsR0FBR0UsVUFBVSxDQUFDO1FBRTFDLE1BQU1DLE1BQU1DLEtBQUtELEdBQUc7UUFDcEIsTUFBTUUsY0FBY0YsTUFBTSxPQUFPLG9CQUFvQjtRQUNyRCxNQUFNRyxNQUFNLEdBQUdmLE9BQU9nQixFQUFFLENBQUMsQ0FBQyxFQUFFZixVQUFVO1FBRXRDLDhCQUE4QjtRQUM5QixNQUFNZ0IsZ0JBQWdCLE1BQU1QLG9CQUFvQlEsT0FBTyxDQUFDO1lBQUVIO1FBQUk7UUFFOUQsSUFBSSxDQUFDRSxlQUFlO1lBQ2xCLG9DQUFvQztZQUNwQyxNQUFNUCxvQkFBb0JTLFNBQVMsQ0FBQztnQkFDbENKO2dCQUNBSyxPQUFPO2dCQUNQQyxXQUFXVCxNQUFNO2dCQUNqQlUsa0JBQWtCVjtnQkFDbEJXLGlCQUFpQlg7WUFDbkI7UUFDRixPQUFPO1lBQ0wsOEJBQThCO1lBQzlCLElBQUlBLE1BQU1LLGNBQWNJLFNBQVMsRUFBRTtnQkFDakMsbUJBQW1CO2dCQUNuQixNQUFNWCxvQkFBb0JjLFNBQVMsQ0FDakM7b0JBQUVUO2dCQUFJLEdBQ047b0JBQ0VVLE1BQU07d0JBQ0pMLE9BQU87d0JBQ1BDLFdBQVdULE1BQU07d0JBQ2pCVSxrQkFBa0JWO3dCQUNsQlcsaUJBQWlCWDtvQkFDbkI7Z0JBQ0Y7WUFFSixPQUFPO2dCQUNMLHdCQUF3QjtnQkFDeEIsTUFBTWMsY0FBY2QsTUFBTUssY0FBY0ssZ0JBQWdCO2dCQUN4RCxNQUFNSyxrQkFBa0IsY0FBZVAsS0FBSyxHQUFJLFNBQVFNLFdBQVUsSUFBTTtnQkFFeEUsbUNBQW1DO2dCQUNuQyxJQUNFQyxtQkFBbUIzQixPQUFPNEIsUUFBUSxDQUFDaEMsU0FBUyxDQUFDaUMsaUJBQWlCLElBQzlEWixjQUFjRyxLQUFLLElBQUlwQixPQUFPNEIsUUFBUSxDQUFDaEMsU0FBUyxDQUFDa0MsU0FBUyxFQUMxRDtvQkFDQSxNQUFNQyxhQUFhQyxLQUFLQyxJQUFJLENBQUMsQ0FBQ2hCLGNBQWNJLFNBQVMsR0FBR1QsR0FBRSxJQUFLO29CQUMvRGQsSUFBSW9DLFNBQVMsQ0FBQyxxQkFBcUJsQyxPQUFPNEIsUUFBUSxDQUFDaEMsU0FBUyxDQUFDaUMsaUJBQWlCO29CQUM5RS9CLElBQUlvQyxTQUFTLENBQUMseUJBQXlCO29CQUN2Q3BDLElBQUlvQyxTQUFTLENBQUMscUJBQXFCRixLQUFLQyxJQUFJLENBQUNoQixjQUFjSSxTQUFTLEdBQUc7b0JBQ3ZFdkIsSUFBSW9DLFNBQVMsQ0FBQyxlQUFlSDtvQkFDN0IsT0FBT2pDLElBQUlPLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7d0JBQzFCQyxPQUFPO3dCQUNQd0I7b0JBQ0Y7Z0JBQ0Y7Z0JBRUEsaUJBQWlCO2dCQUNqQixNQUFNckIsb0JBQW9CYyxTQUFTLENBQ2pDO29CQUFFVDtnQkFBSSxHQUNOO29CQUNFb0IsTUFBTTt3QkFBRWYsT0FBTztvQkFBRTtvQkFDakJLLE1BQU07d0JBQUVGLGlCQUFpQlg7b0JBQUk7Z0JBQy9CO1lBRUo7UUFDRjtRQUVBLHlCQUF5QjtRQUN6QixNQUFNd0IsWUFBWUosS0FBS0ssR0FBRyxDQUN4QixHQUNBckMsT0FBTzRCLFFBQVEsQ0FBQ2hDLFNBQVMsQ0FBQ2lDLGlCQUFpQixHQUFJWixDQUFBQSxlQUFlRyxTQUFTO1FBRXpFdEIsSUFBSW9DLFNBQVMsQ0FBQyxxQkFBcUJsQyxPQUFPNEIsUUFBUSxDQUFDaEMsU0FBUyxDQUFDaUMsaUJBQWlCO1FBQzlFL0IsSUFBSW9DLFNBQVMsQ0FBQyx5QkFBeUJFO1FBQ3ZDdEMsSUFBSW9DLFNBQVMsQ0FBQyxxQkFBcUJGLEtBQUtDLElBQUksQ0FBQyxDQUFDaEIsZUFBZUksYUFBY1QsTUFBTSxLQUFLLElBQUs7UUFFM0YsdURBQXVEO1FBQ3ZERixvQkFBb0I0QixVQUFVLENBQUM7WUFDN0JqQixXQUFXO2dCQUFFa0IsS0FBSzNCO1lBQUk7UUFDeEIsR0FBRzRCLEtBQUssQ0FBQ0MsQ0FBQUEsTUFBT0MsUUFBUW5DLEtBQUssQ0FBQyxrQ0FBa0NrQztRQUVoRTFDO0lBQ0YsRUFBRSxPQUFPUSxPQUFPO1FBQ2RtQyxRQUFRbkMsS0FBSyxDQUFDLHdCQUF3QkE7UUFDdEMsT0FBT1QsSUFBSU8sTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUFFQyxPQUFPO1FBQXdCO0lBQy9EO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9tb2xkb3Zhbi9Qcm9qZWN0cy9zc28vbGliL21pZGRsZXdhcmUvcmF0ZUxpbWl0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRBcGlSZXF1ZXN0LCBOZXh0QXBpUmVzcG9uc2UgfSBmcm9tICduZXh0JztcbmltcG9ydCB7IE1vbmdvQ2xpZW50IH0gZnJvbSAnbW9uZ29kYic7XG5pbXBvcnQgY2xpZW50UHJvbWlzZSBmcm9tICcuLi9tb25nb2RiJztcblxuaW50ZXJmYWNlIFJhdGVMaW1pdENvbmZpZyB7XG4gIHJlcXVlc3RzUGVyTWludXRlOiBudW1iZXI7XG4gIGJ1cnN0U2l6ZTogbnVtYmVyO1xufVxuXG5pbnRlcmZhY2UgUmF0ZUxpbWl0SW5mbyB7XG4gIGNvdW50OiBudW1iZXI7XG4gIHJlc2V0VGltZTogbnVtYmVyO1xuICBmaXJzdFJlcXVlc3RUaW1lOiBudW1iZXI7XG59XG5cbi8vIFNsaWRpbmcgd2luZG93IHJhdGUgbGltaXRlciB3aXRoIGJ1cnN0IGNvbnRyb2xcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByYXRlTGltaXQoXG4gIHJlcTogTmV4dEFwaVJlcXVlc3QsXG4gIHJlczogTmV4dEFwaVJlc3BvbnNlLFxuICBuZXh0OiAoKSA9PiB2b2lkXG4pIHtcbiAgY29uc3QgdGVuYW50ID0gKHJlcSBhcyBhbnkpLnRlbmFudDtcbiAgY29uc3QgY2xpZW50SXAgPSByZXEuaGVhZGVyc1sneC1mb3J3YXJkZWQtZm9yJ10gYXMgc3RyaW5nIHx8IHJlcS5zb2NrZXQucmVtb3RlQWRkcmVzcztcbiAgXG4gIGlmICghdGVuYW50KSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdUZW5hbnQgaW5mb3JtYXRpb24gbWlzc2luZycgfSk7XG4gIH1cblxuICB0cnkge1xuICAgIGNvbnN0IGNsaWVudDogTW9uZ29DbGllbnQgPSBhd2FpdCBjbGllbnRQcm9taXNlO1xuICAgIGNvbnN0IGRiID0gY2xpZW50LmRiKCdzc28nKTtcbiAgICBjb25zdCByYXRlTGltaXRDb2xsZWN0aW9uID0gZGIuY29sbGVjdGlvbigncmF0ZV9saW1pdHMnKTtcblxuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG4gICAgY29uc3Qgd2luZG93U3RhcnQgPSBub3cgLSA2MDAwMDsgLy8gT25lIG1pbnV0ZSB3aW5kb3dcbiAgICBjb25zdCBrZXkgPSBgJHt0ZW5hbnQuaWR9OiR7Y2xpZW50SXB9YDtcblxuICAgIC8vIEdldCBjdXJyZW50IHJhdGUgbGltaXQgaW5mb1xuICAgIGNvbnN0IHJhdGVMaW1pdEluZm8gPSBhd2FpdCByYXRlTGltaXRDb2xsZWN0aW9uLmZpbmRPbmUoeyBrZXkgfSk7XG4gICAgXG4gICAgaWYgKCFyYXRlTGltaXRJbmZvKSB7XG4gICAgICAvLyBGaXJzdCByZXF1ZXN0IGZyb20gdGhpcyB0ZW5hbnQrSVBcbiAgICAgIGF3YWl0IHJhdGVMaW1pdENvbGxlY3Rpb24uaW5zZXJ0T25lKHtcbiAgICAgICAga2V5LFxuICAgICAgICBjb3VudDogMSxcbiAgICAgICAgcmVzZXRUaW1lOiBub3cgKyA2MDAwMCxcbiAgICAgICAgZmlyc3RSZXF1ZXN0VGltZTogbm93LFxuICAgICAgICBsYXN0UmVxdWVzdFRpbWU6IG5vd1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIENoZWNrIGlmIHdpbmRvdyBoYXMgZXhwaXJlZFxuICAgICAgaWYgKG5vdyA+IHJhdGVMaW1pdEluZm8ucmVzZXRUaW1lKSB7XG4gICAgICAgIC8vIFN0YXJ0IG5ldyB3aW5kb3dcbiAgICAgICAgYXdhaXQgcmF0ZUxpbWl0Q29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgeyBrZXkgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICAkc2V0OiB7XG4gICAgICAgICAgICAgIGNvdW50OiAxLFxuICAgICAgICAgICAgICByZXNldFRpbWU6IG5vdyArIDYwMDAwLFxuICAgICAgICAgICAgICBmaXJzdFJlcXVlc3RUaW1lOiBub3csXG4gICAgICAgICAgICAgIGxhc3RSZXF1ZXN0VGltZTogbm93XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gV2l0aGluIGN1cnJlbnQgd2luZG93XG4gICAgICAgIGNvbnN0IGVsYXBzZWRUaW1lID0gbm93IC0gcmF0ZUxpbWl0SW5mby5maXJzdFJlcXVlc3RUaW1lO1xuICAgICAgICBjb25zdCBub3JtYWxpemVkQ291bnQgPSAocmF0ZUxpbWl0SW5mby5jb3VudCAqICg2MDAwMCAtIGVsYXBzZWRUaW1lKSkgLyA2MDAwMDtcblxuICAgICAgICAvLyBDaGVjayBib3RoIHJhdGUgYW5kIGJ1cnN0IGxpbWl0c1xuICAgICAgICBpZiAoXG4gICAgICAgICAgbm9ybWFsaXplZENvdW50ID49IHRlbmFudC5zZXR0aW5ncy5yYXRlTGltaXQucmVxdWVzdHNQZXJNaW51dGUgfHxcbiAgICAgICAgICByYXRlTGltaXRJbmZvLmNvdW50ID49IHRlbmFudC5zZXR0aW5ncy5yYXRlTGltaXQuYnVyc3RTaXplXG4gICAgICAgICkge1xuICAgICAgICAgIGNvbnN0IHJldHJ5QWZ0ZXIgPSBNYXRoLmNlaWwoKHJhdGVMaW1pdEluZm8ucmVzZXRUaW1lIC0gbm93KSAvIDEwMDApO1xuICAgICAgICAgIHJlcy5zZXRIZWFkZXIoJ1gtUmF0ZUxpbWl0LUxpbWl0JywgdGVuYW50LnNldHRpbmdzLnJhdGVMaW1pdC5yZXF1ZXN0c1Blck1pbnV0ZSk7XG4gICAgICAgICAgcmVzLnNldEhlYWRlcignWC1SYXRlTGltaXQtUmVtYWluaW5nJywgMCk7XG4gICAgICAgICAgcmVzLnNldEhlYWRlcignWC1SYXRlTGltaXQtUmVzZXQnLCBNYXRoLmNlaWwocmF0ZUxpbWl0SW5mby5yZXNldFRpbWUgLyAxMDAwKSk7XG4gICAgICAgICAgcmVzLnNldEhlYWRlcignUmV0cnktQWZ0ZXInLCByZXRyeUFmdGVyKTtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MjkpLmpzb24oe1xuICAgICAgICAgICAgZXJyb3I6ICdSYXRlIGxpbWl0IGV4Y2VlZGVkJyxcbiAgICAgICAgICAgIHJldHJ5QWZ0ZXJcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFVwZGF0ZSBjb3VudGVyXG4gICAgICAgIGF3YWl0IHJhdGVMaW1pdENvbGxlY3Rpb24udXBkYXRlT25lKFxuICAgICAgICAgIHsga2V5IH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgJGluYzogeyBjb3VudDogMSB9LFxuICAgICAgICAgICAgJHNldDogeyBsYXN0UmVxdWVzdFRpbWU6IG5vdyB9XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFNldCByYXRlIGxpbWl0IGhlYWRlcnNcbiAgICBjb25zdCByZW1haW5pbmcgPSBNYXRoLm1heChcbiAgICAgIDAsXG4gICAgICB0ZW5hbnQuc2V0dGluZ3MucmF0ZUxpbWl0LnJlcXVlc3RzUGVyTWludXRlIC0gKHJhdGVMaW1pdEluZm8/LmNvdW50IHx8IDEpXG4gICAgKTtcbiAgICByZXMuc2V0SGVhZGVyKCdYLVJhdGVMaW1pdC1MaW1pdCcsIHRlbmFudC5zZXR0aW5ncy5yYXRlTGltaXQucmVxdWVzdHNQZXJNaW51dGUpO1xuICAgIHJlcy5zZXRIZWFkZXIoJ1gtUmF0ZUxpbWl0LVJlbWFpbmluZycsIHJlbWFpbmluZyk7XG4gICAgcmVzLnNldEhlYWRlcignWC1SYXRlTGltaXQtUmVzZXQnLCBNYXRoLmNlaWwoKHJhdGVMaW1pdEluZm8/LnJlc2V0VGltZSB8fCAobm93ICsgNjAwMDApKSAvIDEwMDApKTtcblxuICAgIC8vIENsZWFuIHVwIG9sZCByYXRlIGxpbWl0IGVudHJpZXMgcGVyaW9kaWNhbGx5IChhc3luYylcbiAgICByYXRlTGltaXRDb2xsZWN0aW9uLmRlbGV0ZU1hbnkoe1xuICAgICAgcmVzZXRUaW1lOiB7ICRsdDogbm93IH1cbiAgICB9KS5jYXRjaChlcnIgPT4gY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGNsZWFudXAgcmF0ZSBsaW1pdHM6JywgZXJyKSk7XG5cbiAgICBuZXh0KCk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignUmF0ZSBsaW1pdGluZyBlcnJvcjonLCBlcnJvcik7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InIH0pO1xuICB9XG59XG4iXSwibmFtZXMiOlsiY2xpZW50UHJvbWlzZSIsInJhdGVMaW1pdCIsInJlcSIsInJlcyIsIm5leHQiLCJ0ZW5hbnQiLCJjbGllbnRJcCIsImhlYWRlcnMiLCJzb2NrZXQiLCJyZW1vdGVBZGRyZXNzIiwic3RhdHVzIiwianNvbiIsImVycm9yIiwiY2xpZW50IiwiZGIiLCJyYXRlTGltaXRDb2xsZWN0aW9uIiwiY29sbGVjdGlvbiIsIm5vdyIsIkRhdGUiLCJ3aW5kb3dTdGFydCIsImtleSIsImlkIiwicmF0ZUxpbWl0SW5mbyIsImZpbmRPbmUiLCJpbnNlcnRPbmUiLCJjb3VudCIsInJlc2V0VGltZSIsImZpcnN0UmVxdWVzdFRpbWUiLCJsYXN0UmVxdWVzdFRpbWUiLCJ1cGRhdGVPbmUiLCIkc2V0IiwiZWxhcHNlZFRpbWUiLCJub3JtYWxpemVkQ291bnQiLCJzZXR0aW5ncyIsInJlcXVlc3RzUGVyTWludXRlIiwiYnVyc3RTaXplIiwicmV0cnlBZnRlciIsIk1hdGgiLCJjZWlsIiwic2V0SGVhZGVyIiwiJGluYyIsInJlbWFpbmluZyIsIm1heCIsImRlbGV0ZU1hbnkiLCIkbHQiLCJjYXRjaCIsImVyciIsImNvbnNvbGUiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./lib/middleware/rateLimit.ts\n");

/***/ }),

/***/ "(api-node)/./lib/middleware/requestLogger.ts":
/*!*****************************************!*\
  !*** ./lib/middleware/requestLogger.ts ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   requestLogger: () => (/* binding */ requestLogger)\n/* harmony export */ });\n/* harmony import */ var _mongodb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../mongodb */ \"(api-node)/./lib/mongodb.ts\");\n\nasync function requestLogger(req, res, next) {\n    const startTime = Date.now();\n    const clientIp = req.headers['x-forwarded-for'] || req.socket.remoteAddress;\n    // Create a reference to the original res.end\n    const originalEnd = res.end;\n    let statusCode = 200;\n    let error;\n    // Override res.end to capture the status code and log the request\n    const newEnd = function(chunk, encoding, callback) {\n        const responseTime = Date.now() - startTime;\n        statusCode = res.statusCode;\n        // Log the request asynchronously\n        (async ()=>{\n            try {\n                const client = await _mongodb__WEBPACK_IMPORTED_MODULE_0__[\"default\"];\n                const db = client.db('sso');\n                const logsCollection = db.collection('request_logs');\n                const logEntry = {\n                    timestamp: new Date().toISOString(),\n                    method: req.method || 'UNKNOWN',\n                    url: req.url || '',\n                    ip: clientIp || 'UNKNOWN',\n                    userAgent: req.headers['user-agent'] || 'UNKNOWN',\n                    tenantId: req.tenant?.id,\n                    statusCode,\n                    responseTime,\n                    error: error\n                };\n                // Asynchronously log to MongoDB\n                await logsCollection.insertOne(logEntry);\n            } catch (err) {\n                console.error('Failed to log request:', err);\n            }\n        })();\n        // Handle overloaded function signature\n        if (typeof encoding === 'function') {\n            callback = encoding;\n            encoding = undefined;\n        }\n        // Call the original end method\n        return originalEnd.call(res, chunk, encoding, callback);\n    };\n    // Override the end method\n    res.end = newEnd;\n    // Catch any errors\n    try {\n        await next();\n    } catch (err) {\n        error = err.message || 'Internal Server Error';\n        throw err;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9taWRkbGV3YXJlL3JlcXVlc3RMb2dnZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFFdUM7QUFjaEMsZUFBZUMsY0FDcEJDLEdBQW1CLEVBQ25CQyxHQUFvQixFQUNwQkMsSUFBZ0I7SUFFaEIsTUFBTUMsWUFBWUMsS0FBS0MsR0FBRztJQUMxQixNQUFNQyxXQUFXTixJQUFJTyxPQUFPLENBQUMsa0JBQWtCLElBQWNQLElBQUlRLE1BQU0sQ0FBQ0MsYUFBYTtJQUVyRiw2Q0FBNkM7SUFDN0MsTUFBTUMsY0FBY1QsSUFBSVUsR0FBRztJQUMzQixJQUFJQyxhQUFhO0lBQ2pCLElBQUlDO0lBRUosa0VBQWtFO0lBQ2xFLE1BQU1DLFNBQVMsU0FBVUMsS0FBVSxFQUFFQyxRQUF3QyxFQUFFQyxRQUFxQjtRQUNsRyxNQUFNQyxlQUFlZCxLQUFLQyxHQUFHLEtBQUtGO1FBQ2xDUyxhQUFhWCxJQUFJVyxVQUFVO1FBRTNCLGlDQUFpQztRQUNoQztZQUNDLElBQUk7Z0JBQ0YsTUFBTU8sU0FBc0IsTUFBTXJCLGdEQUFhQTtnQkFDL0MsTUFBTXNCLEtBQUtELE9BQU9DLEVBQUUsQ0FBQztnQkFDckIsTUFBTUMsaUJBQWlCRCxHQUFHRSxVQUFVLENBQUM7Z0JBRXJDLE1BQU1DLFdBQXVCO29CQUMzQkMsV0FBVyxJQUFJcEIsT0FBT3FCLFdBQVc7b0JBQ2pDQyxRQUFRMUIsSUFBSTBCLE1BQU0sSUFBSTtvQkFDdEJDLEtBQUszQixJQUFJMkIsR0FBRyxJQUFJO29CQUNoQkMsSUFBSXRCLFlBQVk7b0JBQ2hCdUIsV0FBVzdCLElBQUlPLE9BQU8sQ0FBQyxhQUFhLElBQUk7b0JBQ3hDdUIsVUFBVSxJQUFhQyxNQUFNLEVBQUVDO29CQUMvQnBCO29CQUNBTTtvQkFDQUwsT0FBT0E7Z0JBQ1Q7Z0JBRUEsZ0NBQWdDO2dCQUNoQyxNQUFNUSxlQUFlWSxTQUFTLENBQUNWO1lBQ2pDLEVBQUUsT0FBT1csS0FBSztnQkFDWkMsUUFBUXRCLEtBQUssQ0FBQywwQkFBMEJxQjtZQUMxQztRQUNGO1FBRUEsdUNBQXVDO1FBQ3ZDLElBQUksT0FBT2xCLGFBQWEsWUFBWTtZQUNsQ0MsV0FBV0Q7WUFDWEEsV0FBV29CO1FBQ2I7UUFFQSwrQkFBK0I7UUFDL0IsT0FBTzFCLFlBQVkyQixJQUFJLENBQUNwQyxLQUFLYyxPQUFPQyxVQUFVQztJQUNoRDtJQUVBLDBCQUEwQjtJQUMxQmhCLElBQUlVLEdBQUcsR0FBR0c7SUFFVixtQkFBbUI7SUFDbkIsSUFBSTtRQUNGLE1BQU1aO0lBQ1IsRUFBRSxPQUFPZ0MsS0FBVTtRQUNqQnJCLFFBQVFxQixJQUFJSSxPQUFPLElBQUk7UUFDdkIsTUFBTUo7SUFDUjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvbW9sZG92YW4vUHJvamVjdHMvc3NvL2xpYi9taWRkbGV3YXJlL3JlcXVlc3RMb2dnZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gJ25leHQnO1xuaW1wb3J0IHsgTW9uZ29DbGllbnQgfSBmcm9tICdtb25nb2RiJztcbmltcG9ydCBjbGllbnRQcm9taXNlIGZyb20gJy4uL21vbmdvZGInO1xuXG5pbnRlcmZhY2UgUmVxdWVzdExvZyB7XG4gIHRpbWVzdGFtcDogc3RyaW5nO1xuICBtZXRob2Q6IHN0cmluZztcbiAgdXJsOiBzdHJpbmc7XG4gIGlwOiBzdHJpbmc7XG4gIHVzZXJBZ2VudDogc3RyaW5nO1xuICB0ZW5hbnRJZD86IHN0cmluZztcbiAgc3RhdHVzQ29kZTogbnVtYmVyO1xuICByZXNwb25zZVRpbWU6IG51bWJlcjtcbiAgZXJyb3I/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZXF1ZXN0TG9nZ2VyKFxuICByZXE6IE5leHRBcGlSZXF1ZXN0LFxuICByZXM6IE5leHRBcGlSZXNwb25zZSxcbiAgbmV4dDogKCkgPT4gdm9pZFxuKSB7XG4gIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gIGNvbnN0IGNsaWVudElwID0gcmVxLmhlYWRlcnNbJ3gtZm9yd2FyZGVkLWZvciddIGFzIHN0cmluZyB8fCByZXEuc29ja2V0LnJlbW90ZUFkZHJlc3M7XG5cbiAgLy8gQ3JlYXRlIGEgcmVmZXJlbmNlIHRvIHRoZSBvcmlnaW5hbCByZXMuZW5kXG4gIGNvbnN0IG9yaWdpbmFsRW5kID0gcmVzLmVuZDtcbiAgbGV0IHN0YXR1c0NvZGUgPSAyMDA7XG4gIGxldCBlcnJvcjogc3RyaW5nIHwgdW5kZWZpbmVkO1xuXG4gIC8vIE92ZXJyaWRlIHJlcy5lbmQgdG8gY2FwdHVyZSB0aGUgc3RhdHVzIGNvZGUgYW5kIGxvZyB0aGUgcmVxdWVzdFxuICBjb25zdCBuZXdFbmQgPSBmdW5jdGlvbiAoY2h1bms6IGFueSwgZW5jb2Rpbmc/OiBCdWZmZXJFbmNvZGluZyB8ICgoKSA9PiB2b2lkKSwgY2FsbGJhY2s/OiAoKSA9PiB2b2lkKSB7XG4gICAgY29uc3QgcmVzcG9uc2VUaW1lID0gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZTtcbiAgICBzdGF0dXNDb2RlID0gcmVzLnN0YXR1c0NvZGU7XG5cbiAgICAvLyBMb2cgdGhlIHJlcXVlc3QgYXN5bmNocm9ub3VzbHlcbiAgICAoYXN5bmMgKCkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY2xpZW50OiBNb25nb0NsaWVudCA9IGF3YWl0IGNsaWVudFByb21pc2U7XG4gICAgICAgIGNvbnN0IGRiID0gY2xpZW50LmRiKCdzc28nKTtcbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBkYi5jb2xsZWN0aW9uKCdyZXF1ZXN0X2xvZ3MnKTtcblxuICAgICAgICBjb25zdCBsb2dFbnRyeTogUmVxdWVzdExvZyA9IHtcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICBtZXRob2Q6IHJlcS5tZXRob2QgfHwgJ1VOS05PV04nLFxuICAgICAgICAgIHVybDogcmVxLnVybCB8fCAnJyxcbiAgICAgICAgICBpcDogY2xpZW50SXAgfHwgJ1VOS05PV04nLFxuICAgICAgICAgIHVzZXJBZ2VudDogcmVxLmhlYWRlcnNbJ3VzZXItYWdlbnQnXSB8fCAnVU5LTk9XTicsXG4gICAgICAgICAgdGVuYW50SWQ6IChyZXEgYXMgYW55KS50ZW5hbnQ/LmlkLFxuICAgICAgICAgIHN0YXR1c0NvZGUsXG4gICAgICAgICAgcmVzcG9uc2VUaW1lLFxuICAgICAgICAgIGVycm9yOiBlcnJvclxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIEFzeW5jaHJvbm91c2x5IGxvZyB0byBNb25nb0RCXG4gICAgICAgIGF3YWl0IGxvZ3NDb2xsZWN0aW9uLmluc2VydE9uZShsb2dFbnRyeSk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGxvZyByZXF1ZXN0OicsIGVycik7XG4gICAgICB9XG4gICAgfSkoKTtcblxuICAgIC8vIEhhbmRsZSBvdmVybG9hZGVkIGZ1bmN0aW9uIHNpZ25hdHVyZVxuICAgIGlmICh0eXBlb2YgZW5jb2RpbmcgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIGNhbGxiYWNrID0gZW5jb2Rpbmc7XG4gICAgICBlbmNvZGluZyA9IHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICAvLyBDYWxsIHRoZSBvcmlnaW5hbCBlbmQgbWV0aG9kXG4gICAgcmV0dXJuIG9yaWdpbmFsRW5kLmNhbGwocmVzLCBjaHVuaywgZW5jb2RpbmcsIGNhbGxiYWNrKTtcbiAgfTtcblxuICAvLyBPdmVycmlkZSB0aGUgZW5kIG1ldGhvZFxuICByZXMuZW5kID0gbmV3RW5kO1xuXG4gIC8vIENhdGNoIGFueSBlcnJvcnNcbiAgdHJ5IHtcbiAgICBhd2FpdCBuZXh0KCk7XG4gIH0gY2F0Y2ggKGVycjogYW55KSB7XG4gICAgZXJyb3IgPSBlcnIubWVzc2FnZSB8fCAnSW50ZXJuYWwgU2VydmVyIEVycm9yJztcbiAgICB0aHJvdyBlcnI7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJjbGllbnRQcm9taXNlIiwicmVxdWVzdExvZ2dlciIsInJlcSIsInJlcyIsIm5leHQiLCJzdGFydFRpbWUiLCJEYXRlIiwibm93IiwiY2xpZW50SXAiLCJoZWFkZXJzIiwic29ja2V0IiwicmVtb3RlQWRkcmVzcyIsIm9yaWdpbmFsRW5kIiwiZW5kIiwic3RhdHVzQ29kZSIsImVycm9yIiwibmV3RW5kIiwiY2h1bmsiLCJlbmNvZGluZyIsImNhbGxiYWNrIiwicmVzcG9uc2VUaW1lIiwiY2xpZW50IiwiZGIiLCJsb2dzQ29sbGVjdGlvbiIsImNvbGxlY3Rpb24iLCJsb2dFbnRyeSIsInRpbWVzdGFtcCIsInRvSVNPU3RyaW5nIiwibWV0aG9kIiwidXJsIiwiaXAiLCJ1c2VyQWdlbnQiLCJ0ZW5hbnRJZCIsInRlbmFudCIsImlkIiwiaW5zZXJ0T25lIiwiZXJyIiwiY29uc29sZSIsInVuZGVmaW5lZCIsImNhbGwiLCJtZXNzYWdlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api-node)/./lib/middleware/requestLogger.ts\n");

/***/ }),

/***/ "(api-node)/./lib/middleware/tenantAuth.ts":
/*!**************************************!*\
  !*** ./lib/middleware/tenantAuth.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   validateTenant: () => (/* binding */ validateTenant)\n/* harmony export */ });\n/* harmony import */ var _mongodb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../mongodb */ \"(api-node)/./lib/mongodb.ts\");\n\n// Rate limiting using a simple in-memory store\n// In production, this should use Redis or a similar distributed cache\nconst rateLimitStore = {};\nasync function validateTenant(req, res, next) {\n    const apiKey = req.headers['x-api-key'];\n    const clientIp = req.headers['x-forwarded-for'] || req.socket.remoteAddress;\n    if (!apiKey) {\n        return res.status(401).json({\n            error: 'API key required'\n        });\n    }\n    try {\n        const client = await _mongodb__WEBPACK_IMPORTED_MODULE_0__[\"default\"];\n        const db = client.db('sso');\n        const tenantsCollection = db.collection('tenants');\n        // Find tenant by API key\n        const tenantDoc = await tenantsCollection.findOne({\n            'apiKeys.key': apiKey\n        });\n        if (!tenantDoc) {\n            return res.status(401).json({\n                error: 'Invalid API key'\n            });\n        }\n        // Map MongoDB document to TenantConfig\n        const tenant = {\n            id: tenantDoc._id.toString(),\n            name: tenantDoc.name,\n            domain: tenantDoc.domain,\n            createdAt: tenantDoc.createdAt,\n            updatedAt: tenantDoc.updatedAt,\n            settings: {\n                allowedRedirectDomains: tenantDoc.settings?.allowedRedirectDomains || [],\n                tokenExpiryMinutes: tenantDoc.settings?.tokenExpiryMinutes || 60,\n                ipWhitelist: tenantDoc.settings?.ipWhitelist || [],\n                rateLimit: {\n                    requestsPerMinute: tenantDoc.settings?.rateLimit?.requestsPerMinute || 100,\n                    burstSize: tenantDoc.settings?.rateLimit?.burstSize || 10\n                }\n            },\n            apiKeys: tenantDoc.apiKeys || []\n        };\n        if (!tenant) {\n            return res.status(401).json({\n                error: 'Invalid API key'\n            });\n        }\n        // Validate IP whitelist\n        if (tenant.settings.ipWhitelist.length > 0 && !tenant.settings.ipWhitelist.includes(clientIp)) {\n            return res.status(403).json({\n                error: 'IP not whitelisted'\n            });\n        }\n        // Check rate limit\n        const now = Date.now();\n        const rateKey = `${tenant.id}:${now - now % 60000}`; // Key for current minute\n        if (!rateLimitStore[rateKey]) {\n            rateLimitStore[rateKey] = {\n                count: 0,\n                resetTime: now + 60000\n            };\n        }\n        if (rateLimitStore[rateKey].count >= tenant.settings.rateLimit.requestsPerMinute) {\n            return res.status(429).json({\n                error: 'Rate limit exceeded'\n            });\n        }\n        rateLimitStore[rateKey].count++;\n        // Clean up expired rate limit entries\n        Object.keys(rateLimitStore).forEach((key)=>{\n            if (rateLimitStore[key].resetTime < now) {\n                delete rateLimitStore[key];\n            }\n        });\n        // Add tenant to request for use in route handlers\n        req.tenant = tenant;\n        // Update API key last used timestamp\n        await tenantsCollection.updateOne({\n            'apiKeys.key': apiKey\n        }, {\n            $set: {\n                'apiKeys.$.lastUsed': new Date().toISOString(),\n                updatedAt: new Date().toISOString()\n            }\n        });\n        next();\n    } catch (error) {\n        console.error('Tenant validation error:', error);\n        return res.status(500).json({\n            error: 'Internal server error'\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9taWRkbGV3YXJlL3RlbmFudEF1dGgudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFFdUM7QUFHdkMsK0NBQStDO0FBQy9DLHNFQUFzRTtBQUN0RSxNQUFNQyxpQkFBMEUsQ0FBQztBQUUxRSxlQUFlQyxlQUNwQkMsR0FBbUIsRUFDbkJDLEdBQW9CLEVBQ3BCQyxJQUFnQjtJQUVoQixNQUFNQyxTQUFTSCxJQUFJSSxPQUFPLENBQUMsWUFBWTtJQUN2QyxNQUFNQyxXQUFXTCxJQUFJSSxPQUFPLENBQUMsa0JBQWtCLElBQWNKLElBQUlNLE1BQU0sQ0FBQ0MsYUFBYTtJQUVyRixJQUFJLENBQUNKLFFBQVE7UUFDWCxPQUFPRixJQUFJTyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQUVDLE9BQU87UUFBbUI7SUFDMUQ7SUFFQSxJQUFJO1FBQ0YsTUFBTUMsU0FBc0IsTUFBTWQsZ0RBQWFBO1FBQy9DLE1BQU1lLEtBQUtELE9BQU9DLEVBQUUsQ0FBQztRQUNyQixNQUFNQyxvQkFBb0JELEdBQUdFLFVBQVUsQ0FBQztRQUV4Qyx5QkFBeUI7UUFDekIsTUFBTUMsWUFBWSxNQUFNRixrQkFBa0JHLE9BQU8sQ0FBQztZQUNoRCxlQUFlYjtRQUNqQjtRQUVBLElBQUksQ0FBQ1ksV0FBVztZQUNkLE9BQU9kLElBQUlPLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7Z0JBQUVDLE9BQU87WUFBa0I7UUFDekQ7UUFFQSx1Q0FBdUM7UUFDdkMsTUFBTU8sU0FBdUI7WUFDM0JDLElBQUlILFVBQVVJLEdBQUcsQ0FBQ0MsUUFBUTtZQUMxQkMsTUFBTU4sVUFBVU0sSUFBSTtZQUNwQkMsUUFBUVAsVUFBVU8sTUFBTTtZQUN4QkMsV0FBV1IsVUFBVVEsU0FBUztZQUM5QkMsV0FBV1QsVUFBVVMsU0FBUztZQUM5QkMsVUFBVTtnQkFDUkMsd0JBQXdCWCxVQUFVVSxRQUFRLEVBQUVDLDBCQUEwQixFQUFFO2dCQUN4RUMsb0JBQW9CWixVQUFVVSxRQUFRLEVBQUVFLHNCQUFzQjtnQkFDOURDLGFBQWFiLFVBQVVVLFFBQVEsRUFBRUcsZUFBZSxFQUFFO2dCQUNsREMsV0FBVztvQkFDVEMsbUJBQW1CZixVQUFVVSxRQUFRLEVBQUVJLFdBQVdDLHFCQUFxQjtvQkFDdkVDLFdBQVdoQixVQUFVVSxRQUFRLEVBQUVJLFdBQVdFLGFBQWE7Z0JBQ3pEO1lBQ0Y7WUFDQUMsU0FBU2pCLFVBQVVpQixPQUFPLElBQUksRUFBRTtRQUNsQztRQUVBLElBQUksQ0FBQ2YsUUFBUTtZQUNYLE9BQU9oQixJQUFJTyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO2dCQUFFQyxPQUFPO1lBQWtCO1FBQ3pEO1FBRUEsd0JBQXdCO1FBQ3hCLElBQUlPLE9BQU9RLFFBQVEsQ0FBQ0csV0FBVyxDQUFDSyxNQUFNLEdBQUcsS0FBSyxDQUFDaEIsT0FBT1EsUUFBUSxDQUFDRyxXQUFXLENBQUNNLFFBQVEsQ0FBQzdCLFdBQVc7WUFDN0YsT0FBT0osSUFBSU8sTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFBRUMsT0FBTztZQUFxQjtRQUM1RDtRQUVBLG1CQUFtQjtRQUNuQixNQUFNeUIsTUFBTUMsS0FBS0QsR0FBRztRQUNwQixNQUFNRSxVQUFVLEdBQUdwQixPQUFPQyxFQUFFLENBQUMsQ0FBQyxFQUFFaUIsTUFBT0EsTUFBTSxPQUFRLEVBQUUseUJBQXlCO1FBRWhGLElBQUksQ0FBQ3JDLGNBQWMsQ0FBQ3VDLFFBQVEsRUFBRTtZQUM1QnZDLGNBQWMsQ0FBQ3VDLFFBQVEsR0FBRztnQkFBRUMsT0FBTztnQkFBR0MsV0FBV0osTUFBTTtZQUFNO1FBQy9EO1FBRUEsSUFBSXJDLGNBQWMsQ0FBQ3VDLFFBQVEsQ0FBQ0MsS0FBSyxJQUFJckIsT0FBT1EsUUFBUSxDQUFDSSxTQUFTLENBQUNDLGlCQUFpQixFQUFFO1lBQ2hGLE9BQU83QixJQUFJTyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO2dCQUFFQyxPQUFPO1lBQXNCO1FBQzdEO1FBRUFaLGNBQWMsQ0FBQ3VDLFFBQVEsQ0FBQ0MsS0FBSztRQUU3QixzQ0FBc0M7UUFDdENFLE9BQU9DLElBQUksQ0FBQzNDLGdCQUFnQjRDLE9BQU8sQ0FBQ0MsQ0FBQUE7WUFDbEMsSUFBSTdDLGNBQWMsQ0FBQzZDLElBQUksQ0FBQ0osU0FBUyxHQUFHSixLQUFLO2dCQUN2QyxPQUFPckMsY0FBYyxDQUFDNkMsSUFBSTtZQUM1QjtRQUNGO1FBRUEsa0RBQWtEO1FBQ2pEM0MsSUFBWWlCLE1BQU0sR0FBR0E7UUFFdEIscUNBQXFDO1FBQ3JDLE1BQU1KLGtCQUFrQitCLFNBQVMsQ0FDL0I7WUFBRSxlQUFlekM7UUFBTyxHQUN4QjtZQUNFMEMsTUFBTTtnQkFDSixzQkFBc0IsSUFBSVQsT0FBT1UsV0FBVztnQkFDNUN0QixXQUFXLElBQUlZLE9BQU9VLFdBQVc7WUFDbkM7UUFDRjtRQUdGNUM7SUFDRixFQUFFLE9BQU9RLE9BQU87UUFDZHFDLFFBQVFyQyxLQUFLLENBQUMsNEJBQTRCQTtRQUMxQyxPQUFPVCxJQUFJTyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQUVDLE9BQU87UUFBd0I7SUFDL0Q7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL21vbGRvdmFuL1Byb2plY3RzL3Nzby9saWIvbWlkZGxld2FyZS90ZW5hbnRBdXRoLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRBcGlSZXF1ZXN0LCBOZXh0QXBpUmVzcG9uc2UgfSBmcm9tICduZXh0JztcbmltcG9ydCB7IE1vbmdvQ2xpZW50IH0gZnJvbSAnbW9uZ29kYic7XG5pbXBvcnQgY2xpZW50UHJvbWlzZSBmcm9tICcuLi9tb25nb2RiJztcbmltcG9ydCB7IFRlbmFudENvbmZpZyB9IGZyb20gJy4uL3R5cGVzL3RlbmFudCc7XG5cbi8vIFJhdGUgbGltaXRpbmcgdXNpbmcgYSBzaW1wbGUgaW4tbWVtb3J5IHN0b3JlXG4vLyBJbiBwcm9kdWN0aW9uLCB0aGlzIHNob3VsZCB1c2UgUmVkaXMgb3IgYSBzaW1pbGFyIGRpc3RyaWJ1dGVkIGNhY2hlXG5jb25zdCByYXRlTGltaXRTdG9yZTogeyBba2V5OiBzdHJpbmddOiB7IGNvdW50OiBudW1iZXI7IHJlc2V0VGltZTogbnVtYmVyIH0gfSA9IHt9O1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdmFsaWRhdGVUZW5hbnQoXG4gIHJlcTogTmV4dEFwaVJlcXVlc3QsXG4gIHJlczogTmV4dEFwaVJlc3BvbnNlLFxuICBuZXh0OiAoKSA9PiB2b2lkXG4pIHtcbiAgY29uc3QgYXBpS2V5ID0gcmVxLmhlYWRlcnNbJ3gtYXBpLWtleSddIGFzIHN0cmluZztcbiAgY29uc3QgY2xpZW50SXAgPSByZXEuaGVhZGVyc1sneC1mb3J3YXJkZWQtZm9yJ10gYXMgc3RyaW5nIHx8IHJlcS5zb2NrZXQucmVtb3RlQWRkcmVzcztcblxuICBpZiAoIWFwaUtleSkge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IGVycm9yOiAnQVBJIGtleSByZXF1aXJlZCcgfSk7XG4gIH1cblxuICB0cnkge1xuICAgIGNvbnN0IGNsaWVudDogTW9uZ29DbGllbnQgPSBhd2FpdCBjbGllbnRQcm9taXNlO1xuICAgIGNvbnN0IGRiID0gY2xpZW50LmRiKCdzc28nKTtcbiAgICBjb25zdCB0ZW5hbnRzQ29sbGVjdGlvbiA9IGRiLmNvbGxlY3Rpb24oJ3RlbmFudHMnKTtcblxuICAgIC8vIEZpbmQgdGVuYW50IGJ5IEFQSSBrZXlcbiAgICBjb25zdCB0ZW5hbnREb2MgPSBhd2FpdCB0ZW5hbnRzQ29sbGVjdGlvbi5maW5kT25lKHtcbiAgICAgICdhcGlLZXlzLmtleSc6IGFwaUtleVxuICAgIH0pO1xuXG4gICAgaWYgKCF0ZW5hbnREb2MpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IGVycm9yOiAnSW52YWxpZCBBUEkga2V5JyB9KTtcbiAgICB9XG5cbiAgICAvLyBNYXAgTW9uZ29EQiBkb2N1bWVudCB0byBUZW5hbnRDb25maWdcbiAgICBjb25zdCB0ZW5hbnQ6IFRlbmFudENvbmZpZyA9IHtcbiAgICAgIGlkOiB0ZW5hbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICBuYW1lOiB0ZW5hbnREb2MubmFtZSxcbiAgICAgIGRvbWFpbjogdGVuYW50RG9jLmRvbWFpbixcbiAgICAgIGNyZWF0ZWRBdDogdGVuYW50RG9jLmNyZWF0ZWRBdCxcbiAgICAgIHVwZGF0ZWRBdDogdGVuYW50RG9jLnVwZGF0ZWRBdCxcbiAgICAgIHNldHRpbmdzOiB7XG4gICAgICAgIGFsbG93ZWRSZWRpcmVjdERvbWFpbnM6IHRlbmFudERvYy5zZXR0aW5ncz8uYWxsb3dlZFJlZGlyZWN0RG9tYWlucyB8fCBbXSxcbiAgICAgICAgdG9rZW5FeHBpcnlNaW51dGVzOiB0ZW5hbnREb2Muc2V0dGluZ3M/LnRva2VuRXhwaXJ5TWludXRlcyB8fCA2MCxcbiAgICAgICAgaXBXaGl0ZWxpc3Q6IHRlbmFudERvYy5zZXR0aW5ncz8uaXBXaGl0ZWxpc3QgfHwgW10sXG4gICAgICAgIHJhdGVMaW1pdDoge1xuICAgICAgICAgIHJlcXVlc3RzUGVyTWludXRlOiB0ZW5hbnREb2Muc2V0dGluZ3M/LnJhdGVMaW1pdD8ucmVxdWVzdHNQZXJNaW51dGUgfHwgMTAwLFxuICAgICAgICAgIGJ1cnN0U2l6ZTogdGVuYW50RG9jLnNldHRpbmdzPy5yYXRlTGltaXQ/LmJ1cnN0U2l6ZSB8fCAxMFxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgYXBpS2V5czogdGVuYW50RG9jLmFwaUtleXMgfHwgW11cbiAgICB9O1xuXG4gICAgaWYgKCF0ZW5hbnQpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IGVycm9yOiAnSW52YWxpZCBBUEkga2V5JyB9KTtcbiAgICB9XG5cbiAgICAvLyBWYWxpZGF0ZSBJUCB3aGl0ZWxpc3RcbiAgICBpZiAodGVuYW50LnNldHRpbmdzLmlwV2hpdGVsaXN0Lmxlbmd0aCA+IDAgJiYgIXRlbmFudC5zZXR0aW5ncy5pcFdoaXRlbGlzdC5pbmNsdWRlcyhjbGllbnRJcCkpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7IGVycm9yOiAnSVAgbm90IHdoaXRlbGlzdGVkJyB9KTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayByYXRlIGxpbWl0XG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICBjb25zdCByYXRlS2V5ID0gYCR7dGVuYW50LmlkfToke25vdyAtIChub3cgJSA2MDAwMCl9YDsgLy8gS2V5IGZvciBjdXJyZW50IG1pbnV0ZVxuICAgIFxuICAgIGlmICghcmF0ZUxpbWl0U3RvcmVbcmF0ZUtleV0pIHtcbiAgICAgIHJhdGVMaW1pdFN0b3JlW3JhdGVLZXldID0geyBjb3VudDogMCwgcmVzZXRUaW1lOiBub3cgKyA2MDAwMCB9O1xuICAgIH1cblxuICAgIGlmIChyYXRlTGltaXRTdG9yZVtyYXRlS2V5XS5jb3VudCA+PSB0ZW5hbnQuc2V0dGluZ3MucmF0ZUxpbWl0LnJlcXVlc3RzUGVyTWludXRlKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MjkpLmpzb24oeyBlcnJvcjogJ1JhdGUgbGltaXQgZXhjZWVkZWQnIH0pO1xuICAgIH1cblxuICAgIHJhdGVMaW1pdFN0b3JlW3JhdGVLZXldLmNvdW50Kys7XG5cbiAgICAvLyBDbGVhbiB1cCBleHBpcmVkIHJhdGUgbGltaXQgZW50cmllc1xuICAgIE9iamVjdC5rZXlzKHJhdGVMaW1pdFN0b3JlKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICBpZiAocmF0ZUxpbWl0U3RvcmVba2V5XS5yZXNldFRpbWUgPCBub3cpIHtcbiAgICAgICAgZGVsZXRlIHJhdGVMaW1pdFN0b3JlW2tleV07XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBBZGQgdGVuYW50IHRvIHJlcXVlc3QgZm9yIHVzZSBpbiByb3V0ZSBoYW5kbGVyc1xuICAgIChyZXEgYXMgYW55KS50ZW5hbnQgPSB0ZW5hbnQ7XG4gICAgXG4gICAgLy8gVXBkYXRlIEFQSSBrZXkgbGFzdCB1c2VkIHRpbWVzdGFtcFxuICAgIGF3YWl0IHRlbmFudHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgIHsgJ2FwaUtleXMua2V5JzogYXBpS2V5IH0sXG4gICAgICB7IFxuICAgICAgICAkc2V0OiB7IFxuICAgICAgICAgICdhcGlLZXlzLiQubGFzdFVzZWQnOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgICAgfSBcbiAgICAgIH1cbiAgICApO1xuXG4gICAgbmV4dCgpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1RlbmFudCB2YWxpZGF0aW9uIGVycm9yOicsIGVycm9yKTtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicgfSk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJjbGllbnRQcm9taXNlIiwicmF0ZUxpbWl0U3RvcmUiLCJ2YWxpZGF0ZVRlbmFudCIsInJlcSIsInJlcyIsIm5leHQiLCJhcGlLZXkiLCJoZWFkZXJzIiwiY2xpZW50SXAiLCJzb2NrZXQiLCJyZW1vdGVBZGRyZXNzIiwic3RhdHVzIiwianNvbiIsImVycm9yIiwiY2xpZW50IiwiZGIiLCJ0ZW5hbnRzQ29sbGVjdGlvbiIsImNvbGxlY3Rpb24iLCJ0ZW5hbnREb2MiLCJmaW5kT25lIiwidGVuYW50IiwiaWQiLCJfaWQiLCJ0b1N0cmluZyIsIm5hbWUiLCJkb21haW4iLCJjcmVhdGVkQXQiLCJ1cGRhdGVkQXQiLCJzZXR0aW5ncyIsImFsbG93ZWRSZWRpcmVjdERvbWFpbnMiLCJ0b2tlbkV4cGlyeU1pbnV0ZXMiLCJpcFdoaXRlbGlzdCIsInJhdGVMaW1pdCIsInJlcXVlc3RzUGVyTWludXRlIiwiYnVyc3RTaXplIiwiYXBpS2V5cyIsImxlbmd0aCIsImluY2x1ZGVzIiwibm93IiwiRGF0ZSIsInJhdGVLZXkiLCJjb3VudCIsInJlc2V0VGltZSIsIk9iamVjdCIsImtleXMiLCJmb3JFYWNoIiwia2V5IiwidXBkYXRlT25lIiwiJHNldCIsInRvSVNPU3RyaW5nIiwiY29uc29sZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./lib/middleware/tenantAuth.ts\n");

/***/ }),

/***/ "(api-node)/./lib/mongodb.ts":
/*!************************!*\
  !*** ./lib/mongodb.ts ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_0__);\n\nconst uri = 'mongodb+srv://moldovancsaba:togwa1-xyhcEp-mozceb@mongodb-sso.zf2o0ix.mongodb.net/?retryWrites=true&w=majority&appName=mongodb-sso';\nconst options = {};\nlet client;\nlet clientPromise;\nif (true) {\n    if (!global._mongoClientPromise) {\n        client = new mongodb__WEBPACK_IMPORTED_MODULE_0__.MongoClient(uri, options);\n        global._mongoClientPromise = client.connect();\n    }\n    clientPromise = global._mongoClientPromise;\n} else {}\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (clientPromise);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9tb25nb2RiLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFzQztBQUV0QyxNQUFNQyxNQUFNO0FBQ1osTUFBTUMsVUFBVSxDQUFDO0FBRWpCLElBQUlDO0FBQ0osSUFBSUM7QUFFSixJQUFJQyxJQUFzQyxFQUFFO0lBQzFDLElBQUksQ0FBQ0MsT0FBT0MsbUJBQW1CLEVBQUU7UUFDL0JKLFNBQVMsSUFBSUgsZ0RBQVdBLENBQUNDLEtBQUtDO1FBQzlCSSxPQUFPQyxtQkFBbUIsR0FBR0osT0FBT0ssT0FBTztJQUM3QztJQUNBSixnQkFBZ0JFLE9BQU9DLG1CQUFtQjtBQUM1QyxPQUFPLEVBR047QUFFRCxpRUFBZUgsYUFBYUEsRUFBQyIsInNvdXJjZXMiOlsiL1VzZXJzL21vbGRvdmFuL1Byb2plY3RzL3Nzby9saWIvbW9uZ29kYi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBNb25nb0NsaWVudCB9IGZyb20gJ21vbmdvZGInO1xuXG5jb25zdCB1cmkgPSAnbW9uZ29kYitzcnY6Ly9tb2xkb3ZhbmNzYWJhOnRvZ3dhMS14eWhjRXAtbW96Y2ViQG1vbmdvZGItc3NvLnpmMm8waXgubW9uZ29kYi5uZXQvP3JldHJ5V3JpdGVzPXRydWUmdz1tYWpvcml0eSZhcHBOYW1lPW1vbmdvZGItc3NvJztcbmNvbnN0IG9wdGlvbnMgPSB7fTtcblxubGV0IGNsaWVudDogTW9uZ29DbGllbnQ7XG5sZXQgY2xpZW50UHJvbWlzZTogUHJvbWlzZTxNb25nb0NsaWVudD47XG5cbmlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50Jykge1xuICBpZiAoIWdsb2JhbC5fbW9uZ29DbGllbnRQcm9taXNlKSB7XG4gICAgY2xpZW50ID0gbmV3IE1vbmdvQ2xpZW50KHVyaSwgb3B0aW9ucyk7XG4gICAgZ2xvYmFsLl9tb25nb0NsaWVudFByb21pc2UgPSBjbGllbnQuY29ubmVjdCgpO1xuICB9XG4gIGNsaWVudFByb21pc2UgPSBnbG9iYWwuX21vbmdvQ2xpZW50UHJvbWlzZTtcbn0gZWxzZSB7XG4gIGNsaWVudCA9IG5ldyBNb25nb0NsaWVudCh1cmksIG9wdGlvbnMpO1xuICBjbGllbnRQcm9taXNlID0gY2xpZW50LmNvbm5lY3QoKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xpZW50UHJvbWlzZTtcbiJdLCJuYW1lcyI6WyJNb25nb0NsaWVudCIsInVyaSIsIm9wdGlvbnMiLCJjbGllbnQiLCJjbGllbnRQcm9taXNlIiwicHJvY2VzcyIsImdsb2JhbCIsIl9tb25nb0NsaWVudFByb21pc2UiLCJjb25uZWN0Il0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api-node)/./lib/mongodb.ts\n");

/***/ }),

/***/ "(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fauth%2Fcreate&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fauth%2Fcreate.ts&middlewareConfigBase64=e30%3D!":
/*!********************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fauth%2Fcreate&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fauth%2Fcreate.ts&middlewareConfigBase64=e30%3D! ***!
  \********************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/pages-api/module.compiled */ \"(api-node)/./node_modules/next/dist/server/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(api-node)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api-node)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_auth_create_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages/api/auth/create.ts */ \"(api-node)/./pages/api/auth/create.ts\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_auth_create_ts__WEBPACK_IMPORTED_MODULE_3__, 'default'));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_auth_create_ts__WEBPACK_IMPORTED_MODULE_3__, 'config');\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/auth/create\",\n        pathname: \"/api/auth/create\",\n        // The following aren't used in production.\n        bundlePath: '',\n        filename: ''\n    },\n    userland: _pages_api_auth_create_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL25vZGVfbW9kdWxlcy9uZXh0L2Rpc3QvYnVpbGQvd2VicGFjay9sb2FkZXJzL25leHQtcm91dGUtbG9hZGVyL2luZGV4LmpzP2tpbmQ9UEFHRVNfQVBJJnBhZ2U9JTJGYXBpJTJGYXV0aCUyRmNyZWF0ZSZwcmVmZXJyZWRSZWdpb249JmFic29sdXRlUGFnZVBhdGg9LiUyRnBhZ2VzJTJGYXBpJTJGYXV0aCUyRmNyZWF0ZS50cyZtaWRkbGV3YXJlQ29uZmlnQmFzZTY0PWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBK0Y7QUFDdkM7QUFDRTtBQUMxRDtBQUN1RDtBQUN2RDtBQUNBLGlFQUFlLHdFQUFLLENBQUMsc0RBQVEsWUFBWSxFQUFDO0FBQzFDO0FBQ08sZUFBZSx3RUFBSyxDQUFDLHNEQUFRO0FBQ3BDO0FBQ08sd0JBQXdCLHlHQUFtQjtBQUNsRDtBQUNBLGNBQWMsa0VBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxZQUFZO0FBQ1osQ0FBQzs7QUFFRCIsInNvdXJjZXMiOlsiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBhZ2VzQVBJUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yb3V0ZS1tb2R1bGVzL3BhZ2VzLWFwaS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IGhvaXN0IH0gZnJvbSBcIm5leHQvZGlzdC9idWlsZC90ZW1wbGF0ZXMvaGVscGVyc1wiO1xuLy8gSW1wb3J0IHRoZSB1c2VybGFuZCBjb2RlLlxuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi4vcGFnZXMvYXBpL2F1dGgvY3JlYXRlLnRzXCI7XG4vLyBSZS1leHBvcnQgdGhlIGhhbmRsZXIgKHNob3VsZCBiZSB0aGUgZGVmYXVsdCBleHBvcnQpLlxuZXhwb3J0IGRlZmF1bHQgaG9pc3QodXNlcmxhbmQsICdkZWZhdWx0Jyk7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCAnY29uZmlnJyk7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9hdXRoL2NyZWF0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2F1dGgvY3JlYXRlXCIsXG4gICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgYXJlbid0IHVzZWQgaW4gcHJvZHVjdGlvbi5cbiAgICAgICAgYnVuZGxlUGF0aDogJycsXG4gICAgICAgIGZpbGVuYW1lOiAnJ1xuICAgIH0sXG4gICAgdXNlcmxhbmRcbn0pO1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wYWdlcy1hcGkuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fauth%2Fcreate&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fauth%2Fcreate.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api-node)/./pages/api/auth/create.ts":
/*!**********************************!*\
  !*** ./pages/api/auth/create.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jsonwebtoken */ \"jsonwebtoken\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jsonwebtoken__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _lib_db_mongodb__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../lib/db/mongodb */ \"(api-node)/./lib/db/mongodb.ts\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _lib_middleware_tenantAuth__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../lib/middleware/tenantAuth */ \"(api-node)/./lib/middleware/tenantAuth.ts\");\n/* harmony import */ var _lib_middleware_rateLimit__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../lib/middleware/rateLimit */ \"(api-node)/./lib/middleware/rateLimit.ts\");\n/* harmony import */ var _lib_middleware_requestLogger__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../lib/middleware/requestLogger */ \"(api-node)/./lib/middleware/requestLogger.ts\");\n/* harmony import */ var _lib_middleware_compose__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../lib/middleware/compose */ \"(api-node)/./lib/middleware/compose.ts\");\n\n\n\n\n\n\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'your-secret-key';\n// Handler with middleware stack\nconst handler = (0,_lib_middleware_compose__WEBPACK_IMPORTED_MODULE_6__.composeMiddleware)(_lib_middleware_tenantAuth__WEBPACK_IMPORTED_MODULE_3__.validateTenant, _lib_middleware_rateLimit__WEBPACK_IMPORTED_MODULE_4__.rateLimit, _lib_middleware_requestLogger__WEBPACK_IMPORTED_MODULE_5__.requestLogger, async function(req, res) {\n    if (req.method !== 'POST') {\n        return res.status(405).json({\n            error: 'Method not allowed'\n        });\n    }\n    try {\n        const { identifier } = req.body;\n        if (!identifier) {\n            return res.status(400).json({\n                error: 'Identifier is required'\n            });\n        }\n        // Create a simple JWT token\n        // Store or update user in MongoDB\n        const client = await _lib_db_mongodb__WEBPACK_IMPORTED_MODULE_1__[\"default\"];\n        const db = client.db('sso');\n        const usersCollection = db.collection('users');\n        const now = new Date().toISOString();\n        // Try to find existing user\n        let user = await usersCollection.findOne({\n            identifier\n        });\n        if (!user) {\n            // Create new user\n            const result = await usersCollection.insertOne({\n                identifier,\n                createdAt: now,\n                lastLoginAt: now\n            });\n            const newUser = await usersCollection.findOne({\n                _id: result.insertedId\n            });\n            user = newUser;\n        } else {\n            // Update last login time\n            await usersCollection.updateOne({\n                _id: new mongodb__WEBPACK_IMPORTED_MODULE_2__.ObjectId(user._id)\n            }, {\n                $set: {\n                    lastLoginAt: now\n                }\n            });\n        }\n        const token = jsonwebtoken__WEBPACK_IMPORTED_MODULE_0___default().sign({\n            userId: user._id.toString(),\n            identifier: user.identifier,\n            iat: Math.floor(Date.now() / 1000)\n        }, JWT_SECRET, {\n            expiresIn: '10m'\n        } // 10 minutes expiry\n        );\n        return res.status(200).json({\n            token\n        });\n    } catch (error) {\n        console.error('Auth error:', error);\n        return res.status(500).json({\n            error: 'Internal server error'\n        });\n    }\n});\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (handler);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL3BhZ2VzL2FwaS9hdXRoL2NyZWF0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQytCO0FBQ3FCO0FBQ2pCO0FBRWlDO0FBQ047QUFDUTtBQUNGO0FBRXBFLE1BQU1PLGFBQWFDLFFBQVFDLEdBQUcsQ0FBQ0YsVUFBVSxJQUFJO0FBRTdDLGdDQUFnQztBQUNoQyxNQUFNRyxVQUFVSiwwRUFBaUJBLENBQy9CSCxzRUFBY0EsRUFDZEMsZ0VBQVNBLEVBQ1RDLHdFQUFhQSxFQUNiLGVBQWdCTSxHQUFtQixFQUFFQyxHQUFvQjtJQUN2RCxJQUFJRCxJQUFJRSxNQUFNLEtBQUssUUFBUTtRQUMzQixPQUFPRCxJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQUVDLE9BQU87UUFBcUI7SUFDNUQ7SUFFQSxJQUFJO1FBQ0YsTUFBTSxFQUFFQyxVQUFVLEVBQUUsR0FBR04sSUFBSU8sSUFBSTtRQUUvQixJQUFJLENBQUNELFlBQVk7WUFDakIsT0FBT0wsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFBRUMsT0FBTztZQUF5QjtRQUM5RDtRQUVBLDRCQUE0QjtRQUM1QixrQ0FBa0M7UUFDbEMsTUFBTUcsU0FBUyxNQUFNbEIsdURBQWFBO1FBQ2xDLE1BQU1tQixLQUFLRCxPQUFPQyxFQUFFLENBQUM7UUFDckIsTUFBTUMsa0JBQWtCRCxHQUFHRSxVQUFVLENBQUM7UUFFdEMsTUFBTUMsTUFBTSxJQUFJQyxPQUFPQyxXQUFXO1FBRWxDLDRCQUE0QjtRQUM1QixJQUFJQyxPQUFPLE1BQU1MLGdCQUFnQk0sT0FBTyxDQUFDO1lBQUVWO1FBQVc7UUFFdEQsSUFBSSxDQUFDUyxNQUFNO1lBQ1Qsa0JBQWtCO1lBQ2xCLE1BQU1FLFNBQVMsTUFBTVAsZ0JBQWdCUSxTQUFTLENBQUM7Z0JBQzdDWjtnQkFDQWEsV0FBV1A7Z0JBQ1hRLGFBQWFSO1lBQ2Y7WUFDQSxNQUFNUyxVQUFVLE1BQU1YLGdCQUFnQk0sT0FBTyxDQUFDO2dCQUFFTSxLQUFLTCxPQUFPTSxVQUFVO1lBQUM7WUFDdkVSLE9BQU9NO1FBQ1QsT0FBTztZQUNMLHlCQUF5QjtZQUN6QixNQUFNWCxnQkFBZ0JjLFNBQVMsQ0FDN0I7Z0JBQUVGLEtBQUssSUFBSS9CLDZDQUFRQSxDQUFDd0IsS0FBS08sR0FBRztZQUFFLEdBQzlCO2dCQUFFRyxNQUFNO29CQUFFTCxhQUFhUjtnQkFBSTtZQUFFO1FBRWpDO1FBRUEsTUFBTWMsUUFBUXJDLHdEQUFRLENBQ3BCO1lBQ0V1QyxRQUFRYixLQUFLTyxHQUFHLENBQUNPLFFBQVE7WUFDekJ2QixZQUFZUyxLQUFLVCxVQUFVO1lBQzNCd0IsS0FBS0MsS0FBS0MsS0FBSyxDQUFDbkIsS0FBS0QsR0FBRyxLQUFLO1FBQy9CLEdBQ0FoQixZQUNBO1lBQUVxQyxXQUFXO1FBQU0sRUFBRSxvQkFBb0I7O1FBRzNDLE9BQU9oQyxJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQUVzQjtRQUFNO0lBQ3RDLEVBQUUsT0FBT3JCLE9BQU87UUFDZDZCLFFBQVE3QixLQUFLLENBQUMsZUFBZUE7UUFDN0IsT0FBT0osSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUFFQyxPQUFPO1FBQXdCO0lBQy9EO0FBQ0Y7QUFFQSxpRUFBZU4sT0FBT0EsRUFBQyIsInNvdXJjZXMiOlsiL1VzZXJzL21vbGRvdmFuL1Byb2plY3RzL3Nzby9wYWdlcy9hcGkvYXV0aC9jcmVhdGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gJ25leHQnO1xuaW1wb3J0IGp3dCBmcm9tICdqc29ud2VidG9rZW4nO1xuaW1wb3J0IGNsaWVudFByb21pc2UgZnJvbSAnLi4vLi4vLi4vbGliL2RiL21vbmdvZGInO1xuaW1wb3J0IHsgT2JqZWN0SWQgfSBmcm9tICdtb25nb2RiJztcbmltcG9ydCB7IFVzZXIgfSBmcm9tICcuLi8uLi8uLi9saWIvdHlwZXMvdXNlcic7XG5pbXBvcnQgeyB2YWxpZGF0ZVRlbmFudCB9IGZyb20gJy4uLy4uLy4uL2xpYi9taWRkbGV3YXJlL3RlbmFudEF1dGgnO1xuaW1wb3J0IHsgcmF0ZUxpbWl0IH0gZnJvbSAnLi4vLi4vLi4vbGliL21pZGRsZXdhcmUvcmF0ZUxpbWl0JztcbmltcG9ydCB7IHJlcXVlc3RMb2dnZXIgfSBmcm9tICcuLi8uLi8uLi9saWIvbWlkZGxld2FyZS9yZXF1ZXN0TG9nZ2VyJztcbmltcG9ydCB7IGNvbXBvc2VNaWRkbGV3YXJlIH0gZnJvbSAnLi4vLi4vLi4vbGliL21pZGRsZXdhcmUvY29tcG9zZSc7XG5cbmNvbnN0IEpXVF9TRUNSRVQgPSBwcm9jZXNzLmVudi5KV1RfU0VDUkVUIHx8ICd5b3VyLXNlY3JldC1rZXknO1xuXG4vLyBIYW5kbGVyIHdpdGggbWlkZGxld2FyZSBzdGFja1xuY29uc3QgaGFuZGxlciA9IGNvbXBvc2VNaWRkbGV3YXJlKFxuICB2YWxpZGF0ZVRlbmFudCxcbiAgcmF0ZUxpbWl0LFxuICByZXF1ZXN0TG9nZ2VyLFxuICBhc3luYyBmdW5jdGlvbiAocmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UpIHtcbiAgICBpZiAocmVxLm1ldGhvZCAhPT0gJ1BPU1QnKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA1KS5qc29uKHsgZXJyb3I6ICdNZXRob2Qgbm90IGFsbG93ZWQnIH0pO1xuICB9XG5cbiAgdHJ5IHtcbiAgICBjb25zdCB7IGlkZW50aWZpZXIgfSA9IHJlcS5ib2R5O1xuXG4gICAgaWYgKCFpZGVudGlmaWVyKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICdJZGVudGlmaWVyIGlzIHJlcXVpcmVkJyB9KTtcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgYSBzaW1wbGUgSldUIHRva2VuXG4gICAgLy8gU3RvcmUgb3IgdXBkYXRlIHVzZXIgaW4gTW9uZ29EQlxuICAgIGNvbnN0IGNsaWVudCA9IGF3YWl0IGNsaWVudFByb21pc2U7XG4gICAgY29uc3QgZGIgPSBjbGllbnQuZGIoJ3NzbycpO1xuICAgIGNvbnN0IHVzZXJzQ29sbGVjdGlvbiA9IGRiLmNvbGxlY3Rpb24oJ3VzZXJzJyk7XG5cbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgXG4gICAgLy8gVHJ5IHRvIGZpbmQgZXhpc3RpbmcgdXNlclxuICAgIGxldCB1c2VyID0gYXdhaXQgdXNlcnNDb2xsZWN0aW9uLmZpbmRPbmUoeyBpZGVudGlmaWVyIH0pO1xuICAgIFxuICAgIGlmICghdXNlcikge1xuICAgICAgLy8gQ3JlYXRlIG5ldyB1c2VyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1c2Vyc0NvbGxlY3Rpb24uaW5zZXJ0T25lKHtcbiAgICAgICAgaWRlbnRpZmllcixcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXG4gICAgICAgIGxhc3RMb2dpbkF0OiBub3dcbiAgICAgIH0pO1xuICAgICAgY29uc3QgbmV3VXNlciA9IGF3YWl0IHVzZXJzQ29sbGVjdGlvbi5maW5kT25lKHsgX2lkOiByZXN1bHQuaW5zZXJ0ZWRJZCB9KTtcbiAgICAgIHVzZXIgPSBuZXdVc2VyO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBVcGRhdGUgbGFzdCBsb2dpbiB0aW1lXG4gICAgICBhd2FpdCB1c2Vyc0NvbGxlY3Rpb24udXBkYXRlT25lKFxuICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKHVzZXIuX2lkKSB9LFxuICAgICAgICB7ICRzZXQ6IHsgbGFzdExvZ2luQXQ6IG5vdyB9IH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgY29uc3QgdG9rZW4gPSBqd3Quc2lnbihcbiAgICAgIHsgXG4gICAgICAgIHVzZXJJZDogdXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgaWRlbnRpZmllcjogdXNlci5pZGVudGlmaWVyLFxuICAgICAgICBpYXQ6IE1hdGguZmxvb3IoRGF0ZS5ub3coKSAvIDEwMDApLFxuICAgICAgfSxcbiAgICAgIEpXVF9TRUNSRVQsXG4gICAgICB7IGV4cGlyZXNJbjogJzEwbScgfSAvLyAxMCBtaW51dGVzIGV4cGlyeVxuICAgICk7XG5cbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyB0b2tlbiB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdBdXRoIGVycm9yOicsIGVycm9yKTtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicgfSk7XG4gIH1cbn0pO1xuXG5leHBvcnQgZGVmYXVsdCBoYW5kbGVyO1xuIl0sIm5hbWVzIjpbImp3dCIsImNsaWVudFByb21pc2UiLCJPYmplY3RJZCIsInZhbGlkYXRlVGVuYW50IiwicmF0ZUxpbWl0IiwicmVxdWVzdExvZ2dlciIsImNvbXBvc2VNaWRkbGV3YXJlIiwiSldUX1NFQ1JFVCIsInByb2Nlc3MiLCJlbnYiLCJoYW5kbGVyIiwicmVxIiwicmVzIiwibWV0aG9kIiwic3RhdHVzIiwianNvbiIsImVycm9yIiwiaWRlbnRpZmllciIsImJvZHkiLCJjbGllbnQiLCJkYiIsInVzZXJzQ29sbGVjdGlvbiIsImNvbGxlY3Rpb24iLCJub3ciLCJEYXRlIiwidG9JU09TdHJpbmciLCJ1c2VyIiwiZmluZE9uZSIsInJlc3VsdCIsImluc2VydE9uZSIsImNyZWF0ZWRBdCIsImxhc3RMb2dpbkF0IiwibmV3VXNlciIsIl9pZCIsImluc2VydGVkSWQiLCJ1cGRhdGVPbmUiLCIkc2V0IiwidG9rZW4iLCJzaWduIiwidXNlcklkIiwidG9TdHJpbmciLCJpYXQiLCJNYXRoIiwiZmxvb3IiLCJleHBpcmVzSW4iLCJjb25zb2xlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api-node)/./pages/api/auth/create.ts\n");

/***/ }),

/***/ "jsonwebtoken":
/*!*******************************!*\
  !*** external "jsonwebtoken" ***!
  \*******************************/
/***/ ((module) => {

module.exports = require("jsonwebtoken");

/***/ }),

/***/ "mongodb":
/*!**************************!*\
  !*** external "mongodb" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("mongodb");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fauth%2Fcreate&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fauth%2Fcreate.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();